{% extends 'asistencia/base.html' %}

{% block title %}
{% if object %}
    Editar Asistencia - {{ block.super }}
{% else %}
    Registrar Asistencia - {{ block.super }}
{% endif %}
{% endblock %}

{% block content %}
<div class="content-card fade-in">
    <div class="page-header">
        <h1 class="page-title">
            {% if object %}
                <i class="bi bi-pencil-fill me-2"></i>
                Editar Asistencia
            {% else %}
                <i class="bi bi-person-plus-fill me-2"></i>
                Registrar Asistencia
            {% endif %}
        </h1>
        <p class="page-subtitle">
            {% if object %}
                Modifique los datos del registro de asistencia
            {% else %}
                Complete el formulario para registrar una nueva asistencia
            {% endif %}
        </p>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <form method="post" novalidate>
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.nombre_completo.id_for_label }}" class="form-label">
                            <i class="bi bi-person me-1"></i>
                            {{ form.nombre_completo.label }}
                        </label>
                        {{ form.nombre_completo }}
                        {% if form.nombre_completo.errors %}
                            <div class="form-text text-danger">
                                {{ form.nombre_completo.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">{{ form.nombre_completo.help_text }}</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.documento_identidad.id_for_label }}" class="form-label">
                            <i class="bi bi-card-text me-1"></i>
                            {{ form.documento_identidad.label }}
                        </label>
                        {{ form.documento_identidad }}
                        {% if form.documento_identidad.errors %}
                            <div class="form-text text-danger">
                                {{ form.documento_identidad.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">{{ form.documento_identidad.help_text }}</div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="{{ form.correo_electronico.id_for_label }}" class="form-label">
                        <i class="bi bi-envelope me-1"></i>
                        {{ form.correo_electronico.label }}
                    </label>
                    {{ form.correo_electronico }}
                    {% if form.correo_electronico.errors %}
                        <div class="form-text text-danger">
                            {{ form.correo_electronico.errors.0 }}
                        </div>
                    {% endif %}
                    <div class="form-text">{{ form.correo_electronico.help_text }}</div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.fecha_asistencia.id_for_label }}" class="form-label">
                            <i class="bi bi-calendar me-1"></i>
                            {{ form.fecha_asistencia.label }}
                        </label>
                        {{ form.fecha_asistencia }}
                        {% if form.fecha_asistencia.errors %}
                            <div class="form-text text-danger">
                                {{ form.fecha_asistencia.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.hora_ingreso.id_for_label }}" class="form-label">
                            <i class="bi bi-clock me-1"></i>
                            {{ form.hora_ingreso.label }}
                        </label>
                        {{ form.hora_ingreso }}
                        {% if form.hora_ingreso.errors %}
                            <div class="form-text text-danger">
                                {{ form.hora_ingreso.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label for="{{ form.hora_salida.id_for_label }}" class="form-label">
                            <i class="bi bi-clock-fill me-1"></i>
                            {{ form.hora_salida.label }}
                        </label>
                        {{ form.hora_salida }}
                        {% if form.hora_salida.errors %}
                            <div class="form-text text-danger">
                                {{ form.hora_salida.errors.0 }}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            {{ form.presente }}
                            <label class="form-check-label" for="{{ form.presente.id_for_label }}">
                                <i class="bi bi-check-circle me-1"></i>
                                {{ form.presente.label }}
                            </label>
                        </div>
                        {% if form.presente.errors %}
                            <div class="form-text text-danger">
                                {{ form.presente.errors.0 }}
                            </div>
                        {% endif %}
                        <div class="form-text">{{ form.presente.help_text }}</div>
                    </div>
                </div>

                <div class="mb-4">
                    <label for="{{ form.observaciones.id_for_label }}" class="form-label">
                        <i class="bi bi-chat-text me-1"></i>
                        {{ form.observaciones.label }}
                    </label>
                    {{ form.observaciones }}
                    {% if form.observaciones.errors %}
                        <div class="form-text text-danger">
                            {{ form.observaciones.errors.0 }}
                        </div>
                    {% endif %}
                    <div class="form-text">{{ form.observaciones.help_text }}</div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="{% url 'asistencia:list' %}" class="btn btn-outline-secondary me-md-2">
                        <i class="bi bi-arrow-left me-1"></i>
                        Cancelar
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-lg me-1"></i>
                        {% if object %}
                            Actualizar Asistencia
                        {% else %}
                            Guardar Asistencia
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add classes to form fields for styling
document.addEventListener('DOMContentLoaded', function() {
    // Add form-control class to all input fields
    const inputs = document.querySelectorAll('input, textarea, select');
    inputs.forEach(input => {
        if (!input.classList.contains('form-check-input')) {
            input.classList.add('form-control');
        }
    });
    
    // Set today's date by default
    const fechaField = document.getElementById('{{ form.fecha_asistencia.id_for_label }}');
    if (fechaField && !fechaField.value) {
        const today = new Date().toISOString().split('T')[0];
        fechaField.value = today;
    }
    
    // Set current time for hora_ingreso if empty
    const horaIngresoField = document.getElementById('{{ form.hora_ingreso.id_for_label }}');
    if (horaIngresoField && !horaIngresoField.value) {
        const now = new Date();
        const timeString = now.toTimeString().slice(0, 5);
        horaIngresoField.value = timeString;
    }
});
</script>
{% endblock %}
